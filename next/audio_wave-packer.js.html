<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>audio/wave-packer.js - ITSLanguage JavaScript SDK</title>
    
    <meta name="description" content="Speech technology for language education. JSDoc 3 website for the JavaScript SDK." />
    
        <meta name="keywords" content="itslangauge, jsdoc, documentation, speech, speech technology" />
        <meta name="keyword" content="itslangauge, jsdoc, documentation, speech, speech technology" />
    
    
    
    <meta property="og:title" content="ITSLanguage JavaScript SDK"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://avatars0.githubusercontent.com/u/20972344?s=400&u=73936e7fa2d2a1e5c180a11675bf9166d3717a6d&v=4"/>
    <meta property="og:site_name" content="ITSLanguage JavaScript SDK"/>
    <meta property="og:url" content="http://itslanguage.github.io/itslanguage-js/"/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/itslanguage/itslanguage-js" target="_blank" class="menu-item" id="repository" >Github repo</a></h2><h3>Modules</h3><ul><li><a href="module-sdk.html">sdk</a><ul class='methods'><li data-type='method'><a href="module-sdk.html#.createAudioPlayer">createAudioPlayer</a></li><li data-type='method'><a href="module-sdk.html#.createAudioRecorder">createAudioRecorder</a></li><li data-type='method'><a href="module-sdk.html#.createItslSdk">createItslSdk</a></li><li data-type='method'><a href="module-sdk.html#.createPlayer">createPlayer</a></li><li data-type='method'><a href="module-sdk.html#.createStopwatch">createStopwatch</a></li><li data-type='method'><a href="module-sdk.html#.createVolumeMeter">createVolumeMeter</a></li></ul></li><li><a href="module-sdk_lib_api_authentication.html">sdk/lib/api/authentication</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_authentication.html#.assembleScope">assembleScope</a></li><li data-type='method'><a href="module-sdk_lib_api_authentication.html#.authenticate">authenticate</a></li><li data-type='method'><a href="module-sdk_lib_api_authentication.html#.impersonate">impersonate</a></li></ul></li><li><a href="module-sdk_lib_api_basicauth.html">sdk/lib/api/basicauth</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_basicauth.html#.create">create</a></li></ul></li><li><a href="module-sdk_lib_api_broadcaster.html">sdk/lib/api/broadcaster</a></li><li><a href="module-sdk_lib_api_categories.html">sdk/lib/api/categories</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_categories.html#.create">create</a></li><li data-type='method'><a href="module-sdk_lib_api_categories.html#.getAll">getAll</a></li><li data-type='method'><a href="module-sdk_lib_api_categories.html#.getAllWithParentId">getAllWithParentId</a></li><li data-type='method'><a href="module-sdk_lib_api_categories.html#.getById">getById</a></li><li data-type='method'><a href="module-sdk_lib_api_categories.html#.update">update</a></li></ul></li><li><a href="module-sdk_lib_api_challenges.html">sdk/lib/api/challenges</a><ul class='members'><li data-type='member'><a href="module-sdk_lib_api_challenges.html#.choice">choice</a></li><li data-type='member'><a href="module-sdk_lib_api_challenges.html#.choiceRecognition">choiceRecognition</a></li><li data-type='member'><a href="module-sdk_lib_api_challenges.html#.feedback">feedback</a></li><li data-type='member'><a href="module-sdk_lib_api_challenges.html#.feedbackSpeech">feedbackSpeech</a></li><li data-type='member'><a href="module-sdk_lib_api_challenges.html#.pronunciation">pronunciation</a></li><li data-type='member'><a href="module-sdk_lib_api_challenges.html#.pronunciationAnalysis">pronunciationAnalysis</a></li><li data-type='member'><a href="module-sdk_lib_api_challenges.html#.speech">speech</a></li><li data-type='member'><a href="module-sdk_lib_api_challenges.html#.speechRecording">speechRecording</a></li></ul></li><li><a href="module-sdk_lib_api_challenges_choice.html">sdk/lib/api/challenges/choice</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_challenges_choice.html#.create">create</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_choice.html#.getAll">getAll</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_choice.html#.getById">getById</a></li></ul></li><li><a href="module-sdk_lib_api_challenges_choice_recognition.html">sdk/lib/api/challenges/choice/recognition</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_challenges_choice_recognition.html#.create">create</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_choice_recognition.html#.getAll">getAll</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_choice_recognition.html#.getById">getById</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_choice_recognition.html#.prepare">prepare</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_choice_recognition.html#.prepareChallenge">prepareChallenge</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_choice_recognition.html#.recognise">recognise</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_choice_recognition.html#.recogniseAudioStream">recogniseAudioStream</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_choice_recognition.html#~url">url</a></li></ul></li><li><a href="module-sdk_lib_api_challenges_feedback.html">sdk/lib/api/challenges/feedback</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_challenges_feedback.html#.create">create</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_feedback.html#.getAll">getAll</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_feedback.html#.getById">getById</a></li></ul></li><li><a href="module-sdk_lib_api_challenges_feedback_speech.html">sdk/lib/api/challenges/feedback/speech</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_challenges_feedback_speech.html#.feedback">feedback</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_feedback_speech.html#.listenAndReply">listenAndReply</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_feedback_speech.html#.pause">pause</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_feedback_speech.html#.prepare">prepare</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_feedback_speech.html#.resume">resume</a></li></ul></li><li><a href="module-sdk_lib_api_challenges_pronunciation.html">sdk/lib/api/challenges/pronunciation</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_challenges_pronunciation.html#.create">create</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_pronunciation.html#.deleteChallenge">deleteChallenge</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_pronunciation.html#.getAll">getAll</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_pronunciation.html#.getById">getById</a></li></ul></li><li><a href="module-sdk_lib_api_challenges_pronunciation_analysis.html">sdk/lib/api/challenges/pronunciation/analysis</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_challenges_pronunciation_analysis.html#.alignChallenge">alignChallenge</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_pronunciation_analysis.html#.endStreamAudio">endStreamAudio</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_pronunciation_analysis.html#.getById">getById</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_pronunciation_analysis.html#.prepare">prepare</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_pronunciation_analysis.html#.prepareAudio">prepareAudio</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_pronunciation_analysis.html#.prepareChallenge">prepareChallenge</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_pronunciation_analysis.html#.streamAudio">streamAudio</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_pronunciation_analysis.html#~url">url</a></li></ul></li><li><a href="module-sdk_lib_api_challenges_speech.html">sdk/lib/api/challenges/speech</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_challenges_speech.html#.create">create</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_speech.html#.getAll">getAll</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_speech.html#.getById">getById</a></li></ul></li><li><a href="module-sdk_lib_api_challenges_speech_recordings.html">sdk/lib/api/challenges/speech/recordings</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_challenges_speech_recordings.html#.getAll">getAll</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_speech_recordings.html#.getById">getById</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_speech_recordings.html#.record">record</a></li><li data-type='method'><a href="module-sdk_lib_api_challenges_speech_recordings.html#~url">url</a></li></ul></li><li><a href="module-sdk_lib_api_communication.html">sdk/lib/api/communication</a><ul class='members'><li data-type='member'><a href="module-sdk_lib_api_communication.html#.settings">settings</a></li><li data-type='member'><a href="module-sdk_lib_api_communication.html#~APPLICATION_JSON">APPLICATION_JSON</a></li><li data-type='member'><a href="module-sdk_lib_api_communication.html#~AUTHORIZATION">AUTHORIZATION</a></li><li data-type='member'><a href="module-sdk_lib_api_communication.html#~CONTENT_TYPE">CONTENT_TYPE</a></li></ul><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_communication.html#.authorisedRequest">authorisedRequest</a></li><li data-type='method'><a href="module-sdk_lib_api_communication.html#.request">request</a></li><li data-type='method'><a href="module-sdk_lib_api_communication.html#.updateSettings">updateSettings</a></li><li data-type='method'><a href="module-sdk_lib_api_communication.html#~getBearerToken">getBearerToken</a></li><li data-type='method'><a href="module-sdk_lib_api_communication.html#~handleResponse">handleResponse</a></li></ul></li><li><a href="module-sdk_lib_api_communication_websocket.html">sdk/lib/api/communication/websocket</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_communication_websocket.html#.closeWebsocketConnection">closeWebsocketConnection</a></li><li data-type='method'><a href="module-sdk_lib_api_communication_websocket.html#.getWebsocketConnection">getWebsocketConnection</a></li><li data-type='method'><a href="module-sdk_lib_api_communication_websocket.html#.makeWebsocketCall">makeWebsocketCall</a></li><li data-type='method'><a href="module-sdk_lib_api_communication_websocket.html#.openWebsocketConnection">openWebsocketConnection</a></li><li data-type='method'><a href="module-sdk_lib_api_communication_websocket.html#~establishNewBundesbahn">establishNewBundesbahn</a></li><li data-type='method'><a href="module-sdk_lib_api_communication_websocket.html#~handleWebsocketAuthorisationChallenge">handleWebsocketAuthorisationChallenge</a></li></ul></li><li><a href="module-sdk_lib_api_emailauth.html">sdk/lib/api/emailauth</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_emailauth.html#.create">create</a></li><li data-type='method'><a href="module-sdk_lib_api_emailauth.html#~url">url</a></li></ul></li><li><a href="module-sdk_lib_api_groups.html">sdk/lib/api/groups</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_groups.html#.create">create</a></li><li data-type='method'><a href="module-sdk_lib_api_groups.html#.getAll">getAll</a></li><li data-type='method'><a href="module-sdk_lib_api_groups.html#.getById">getById</a></li></ul></li><li><a href="module-sdk_lib_api_organisations.html">sdk/lib/api/organisations</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_organisations.html#.create">create</a></li><li data-type='method'><a href="module-sdk_lib_api_organisations.html#.getAll">getAll</a></li><li data-type='method'><a href="module-sdk_lib_api_organisations.html#.getById">getById</a></li></ul></li><li><a href="module-sdk_lib_api_profile.html">sdk/lib/api/profile</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_profile.html#.create">create</a></li><li data-type='method'><a href="module-sdk_lib_api_profile.html#.getById">getById</a></li><li data-type='method'><a href="module-sdk_lib_api_profile.html#.getCurrent">getCurrent</a></li><li data-type='method'><a href="module-sdk_lib_api_profile.html#~url">url</a></li></ul></li><li><a href="module-sdk_lib_api_progress.html">sdk/lib/api/progress</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_progress.html#.getById">getById</a></li></ul></li><li><a href="module-sdk_lib_api_roles.html">sdk/lib/api/roles</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_roles.html#.create">create</a></li><li data-type='method'><a href="module-sdk_lib_api_roles.html#.getAll">getAll</a></li><li data-type='method'><a href="module-sdk_lib_api_roles.html#.getById">getById</a></li></ul></li><li><a href="module-sdk_lib_api_tenants.html">sdk/lib/api/tenants</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_tenants.html#.create">create</a></li><li data-type='method'><a href="module-sdk_lib_api_tenants.html#.getAll">getAll</a></li><li data-type='method'><a href="module-sdk_lib_api_tenants.html#.getById">getById</a></li></ul></li><li><a href="module-sdk_lib_api_users.html">sdk/lib/api/users</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_users.html#.create">create</a></li><li data-type='method'><a href="module-sdk_lib_api_users.html#.getAll">getAll</a></li><li data-type='method'><a href="module-sdk_lib_api_users.html#.getById">getById</a></li><li data-type='method'><a href="module-sdk_lib_api_users.html#.getCurrent">getCurrent</a></li></ul></li><li><a href="module-sdk_lib_api_utils.html">sdk/lib/api/utils</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_utils.html#.dataToBase64">dataToBase64</a></li></ul></li><li><a href="module-sdk_lib_api_utils_audio-over-socket.html">sdk/lib/api/utils/audio-over-socket</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_api_utils_audio-over-socket.html#.encodeAndSendAudioOnDataAvailable">encodeAndSendAudioOnDataAvailable</a></li><li data-type='method'><a href="module-sdk_lib_api_utils_audio-over-socket.html#.prepareServerForAudio">prepareServerForAudio</a></li><li data-type='method'><a href="module-sdk_lib_api_utils_audio-over-socket.html#.registerStreamForRecorder">registerStreamForRecorder</a></li><li data-type='method'><a href="module-sdk_lib_api_utils_audio-over-socket.html#.waitForUserMediaApproval">waitForUserMediaApproval</a></li></ul></li><li><a href="module-sdk_lib_audio_audio-player.html">sdk/lib/audio/audio-player</a></li><li><a href="module-sdk_lib_audio_audio-recorder.html">sdk/lib/audio/audio-recorder</a></li><li><a href="module-sdk_lib_audio_audio-tools.html">sdk/lib/audio/audio-tools</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_audio_audio-tools.html#.generateWaveSample">generateWaveSample</a></li></ul></li><li><a href="module-sdk_lib_audio_tools.html">sdk/lib/audio/tools</a></li><li><a href="module-sdk_lib_audio_wave-packer.html">sdk/lib/audio/wave-packer</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_audio_wave-packer.html#.createWAVEHeader">createWAVEHeader</a></li><li data-type='method'><a href="module-sdk_lib_audio_wave-packer.html#.wordToUTF8ByteArray">wordToUTF8ByteArray</a></li></ul></li><li><a href="module-sdk_lib_WebAudio_AudioContext.html">sdk/lib/WebAudio/AudioContext</a></li><li><a href="module-sdk_lib_WebAudio_Player.html">sdk/lib/WebAudio/Player</a></li><li><a href="module-sdk_lib_WebAudio_Recorder.html">sdk/lib/WebAudio/Recorder</a></li></ul><h3>Classes</h3><ul><li><a href="module-sdk.Itslanguage.html">Itslanguage</a></li><li><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html">AudioPlayer</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#addEventListener">addEventListener</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#bindStopwatch">bindStopwatch</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#canPlay">canPlay</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#getAudioVolume">getAudioVolume</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#getBufferFill">getBufferFill</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#getCurrentTime">getCurrentTime</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#getDuration">getDuration</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#getPlaybackRate">getPlaybackRate</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#isAudioMuted">isAudioMuted</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#isPlaying">isPlaying</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#load">load</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#pause">pause</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#play">play</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#preload">preload</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#removeEventListener">removeEventListener</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#reset">reset</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#resetEventListeners">resetEventListeners</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#scrub">scrub</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#setAudioMute">setAudioMute</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#setAudioVolume">setAudioVolume</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#setPlaybackRate">setPlaybackRate</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#stop">stop</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#toggleAudioMute">toggleAudioMute</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-player-AudioPlayer.html#togglePlayback">togglePlayback</a></li></ul></li><li><a href="module-sdk_lib_audio_audio-recorder-AudioRecorder.html">AudioRecorder</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_audio_audio-recorder-AudioRecorder.html#.createAudioContext">createAudioContext</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-recorder-AudioRecorder.html#addEventListener">addEventListener</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-recorder-AudioRecorder.html#bindStopwatch">bindStopwatch</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-recorder-AudioRecorder.html#getAudioSpecs">getAudioSpecs</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-recorder-AudioRecorder.html#hasUserMediaApproval">hasUserMediaApproval</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-recorder-AudioRecorder.html#isPaused">isPaused</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-recorder-AudioRecorder.html#isRecording">isRecording</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-recorder-AudioRecorder.html#record">record</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-recorder-AudioRecorder.html#removeAllEventListeners">removeAllEventListeners</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-recorder-AudioRecorder.html#removeEventListener">removeEventListener</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-recorder-AudioRecorder.html#requestUserMedia">requestUserMedia</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-recorder-AudioRecorder.html#startRecordingSession">startRecordingSession</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-recorder-AudioRecorder.html#stop">stop</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-recorder-AudioRecorder.html#streamCallback">streamCallback</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-recorder-AudioRecorder.html#toggleRecording">toggleRecording</a></li></ul></li><li><a href="module-sdk_lib_audio_audio-tools-VolumeMeter.html">VolumeMeter</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_audio_audio-tools-VolumeMeter.html#getVolumeIndication">getVolumeIndication</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-tools-VolumeMeter.html#resumeAnalyser">resumeAnalyser</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-tools-VolumeMeter.html#stopAnalyser">stopAnalyser</a></li><li data-type='method'><a href="module-sdk_lib_audio_audio-tools-VolumeMeter.html#updateAnalysers">updateAnalysers</a></li></ul></li><li><a href="module-sdk_lib_audio_tools-Stopwatch.html">Stopwatch</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_audio_tools-Stopwatch.html#reset">reset</a></li><li data-type='method'><a href="module-sdk_lib_audio_tools-Stopwatch.html#start">start</a></li><li data-type='method'><a href="module-sdk_lib_audio_tools-Stopwatch.html#stop">stop</a></li><li data-type='method'><a href="module-sdk_lib_audio_tools-Stopwatch.html#tick">tick</a></li><li data-type='method'><a href="module-sdk_lib_audio_tools-Stopwatch.html#update">update</a></li></ul></li><li><a href="module-sdk_lib_audio_wave-packer-WavePacker.html">WavePacker</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_audio_wave-packer-WavePacker.html#.writeUTFBytes">writeUTFBytes</a></li><li data-type='method'><a href="module-sdk_lib_audio_wave-packer-WavePacker.html#encodeWAV">encodeWAV</a></li><li data-type='method'><a href="module-sdk_lib_audio_wave-packer-WavePacker.html#init">init</a></li></ul></li><li><a href="module-sdk_lib_WebAudio_AudioContext-AudioContext.html">AudioContext</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_WebAudio_AudioContext-AudioContext.html#.createAudioContext">createAudioContext</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_AudioContext-AudioContext.html#addEventListener">addEventListener</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_AudioContext-AudioContext.html#fireEvent">fireEvent</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_AudioContext-AudioContext.html#removeEventListener">removeEventListener</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_AudioContext-AudioContext.html#resumeAudioContext">resumeAudioContext</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_AudioContext-AudioContext.html#suspendAudioContext">suspendAudioContext</a></li></ul></li><li><a href="module-sdk_lib_WebAudio_Player-Player.html">Player</a><ul class='methods'><li data-type='method'><a href="module-sdk_lib_WebAudio_Player-Player.html#audioBufferExists">audioBufferExists</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_Player-Player.html#audioSourceExists">audioSourceExists</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_Player-Player.html#createBufferSource">createBufferSource</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_Player-Player.html#disconnectBufferSource">disconnectBufferSource</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_Player-Player.html#getAudioContext">getAudioContext</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_Player-Player.html#getBufferSource">getBufferSource</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_Player-Player.html#getCurrentTime">getCurrentTime</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_Player-Player.html#getDuration">getDuration</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_Player-Player.html#isPlaying">isPlaying</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_Player-Player.html#load">load</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_Player-Player.html#mute">mute</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_Player-Player.html#pause">pause</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_Player-Player.html#play">play</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_Player-Player.html#setVolume">setVolume</a></li><li data-type='method'><a href="module-sdk_lib_WebAudio_Player-Player.html#stop">stop</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">audio/wave-packer.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module sdk/lib/audio/wave-packer
 */

/**
 * Packer class for audio packing
 */
class WavePacker {
  /**
   * Stop recording audio.
   *
   * @param {number} recordingSampleRate - Sample rate of recording. Must be either 48000 or 44100.
   * @param {number} sampleRate - Sample rate. Must be half or quarter of the recording sample rate.
   * @param {number} channels - Amount of audio channels. 1 or 2.
   */
  init(recordingSampleRate, sampleRate, channels) {
    this.recordingSampleRate = recordingSampleRate;
    if ([48000, 44100].indexOf(this.recordingSampleRate) === -1) {
      throw new Error(
        '48000 or 44100 are the only supported recordingSampleRates',
      );
    }

    this.sampleRate = sampleRate;
    if ([
      this.recordingSampleRate,
      this.recordingSampleRate / 2,
      this.recordingSampleRate / 4,
    ].indexOf(this.sampleRate) === -1) {
      throw new Error(
        'sampleRate must be equal, half or a quarter of the '
        + 'recording sample rate',
      );
    }

    this.channels = channels;
    this.recording = false;
  }

  clear() {
    this.recLength = 0;
    this.recBuffersL = [];
    this.recBuffersR = [];
  }

  record(left, right) {
    this.recBuffersL.push(left);
    this.recBuffersR.push(right);
    this.recLength += left.length;
  }

  recordStreaming(left, right, callback) { // eslint-disable-line class-methods-use-this
    function convertFloat32ToInt16(buffer) {
      let l = buffer.length;
      const buf = new Int16Array(l);
      while (l) {
        buf[l] = Math.min(1, buffer[l]) * 0x7FFF;
        l -= 1;
      }
      return buf.buffer;
    }
    // Both the left and right channel's data is a view (Float32Array)
    // on top of the buffer (ArrayBuffer). Each buffer's element should
    // have _value between -1 and 1.
    // The audio to export are 16 bit PCM samples that are wrapped in
    // a WAVE file at the server. Therefore convert from float here.
    const converted = convertFloat32ToInt16(left);
    callback(converted);
  }

  exportWAV(callback) {
    const bufferL = WavePacker.mergeBuffers(this.recBuffersL, this.recLength);
    const bufferR = WavePacker.mergeBuffers(this.recBuffersR, this.recLength);
    const interleaved = this.interleave(bufferL, bufferR);
    const dataview = this.encodeWAV(interleaved);
    const audioBlob = new Blob([dataview], {
      type: 'audio/wav',
    });
    callback(audioBlob);
  }


  exportMonoWAV(callback) {
    const bufferL = WavePacker.mergeBuffers(this.recBuffersL, this.recLength);
    const dataview = this.encodeWAV(bufferL, true);
    const audioBlob = new Blob([dataview], {
      type: 'audio/wav',
    });
    callback(audioBlob);
  }

  /**
   * Wrap the raw audio in a header to make it a WAVE format.
   *
   * @see {@link https://ccrma.stanford.edu/courses/422/projects/WaveFormat/}.
   *
   * @todo This function should use the {@link createWAVEHeader} function for creating the header.
   * @param {Array} interleaved - Array of interleaved audio.
   */
  encodeWAV(interleaved) {
    const buffer = new ArrayBuffer(44 + interleaved.length * 2);
    const view = new DataView(buffer);

    // RIFF chunk descriptor
    WavePacker.writeUTFBytes(view, 0, 'RIFF');
    // file length
    view.setUint32(4, 44 + interleaved.length * 2, true);
    // RIFF type
    WavePacker.writeUTFBytes(view, 8, 'WAVE');
    // FMT sub-chunk
    WavePacker.writeUTFBytes(view, 12, 'fmt ');
    // format chunk length
    view.setUint32(16, 16, true);
    // sample format (raw)
    view.setUint16(20, 1, true);
    // channel count. mono=1, stereo=2
    view.setUint16(22, this.channels, true);
    // sample rate
    view.setUint32(24, this.sampleRate, true);
    // byte rate (sample rate * block align)
    view.setUint32(28, this.sampleRate * 2 * this.channels, true);
    // block align (channel count * bytes per sample)
    view.setUint16(32, this.channels * 2, true);
    // bits per sample
    view.setUint16(34, 16, true);
    // data sub-chunk
    WavePacker.writeUTFBytes(view, 36, 'data');
    view.setUint32(40, interleaved.length * 2, true);

    // write the PCM samples
    const lng = interleaved.length;
    let index = 44;
    const volume = 1;
    for (let i = 0; i &lt; lng; i += 1) {
      view.setInt16(index, interleaved[i] * (0x7FFF * volume), true);
      index += 2;
    }

    // Wrap in HTML5 Blob for transport
    const blob = new Blob([view], {
      type: 'audio/wav',
    });
    console.log(`Recorded audio/wav Blob size: ${blob.size}`);
    return blob;
  }

  interleave(leftChannel, rightChannel) {
    let channelLength = 0;
    let inputIndex = 0;
    let result = null;
    let i = 0;

    if (this.channels === 1) {
      // Keep both right and left input channels, but "pan" them both
      // in the center (to the single mono channel)
      channelLength = leftChannel.length;
      result = new Float32Array(channelLength);
      for (i = 0; i &lt; leftChannel.length; i += 1) {
        result[i] = 0.5 * (leftChannel[i] + rightChannel[i]);
      }
    } else {
      channelLength = leftChannel.length + rightChannel.length;
      result = new Float32Array(channelLength);

      for (i = 0; i &lt; channelLength; i += 2) {
        result[i] = leftChannel[inputIndex];
        result[i + 1] = rightChannel[inputIndex];
        inputIndex += 1;
      }
    }

    // Also downsample if needed.
    if (this.recordingSampleRate !== this.sampleRate) {
      // E.g. 44100/11025 = 4
      const reduceBy = this.recordingSampleRate / this.sampleRate;
      const resampledResult = new Float32Array(channelLength / reduceBy);

      inputIndex = 0;
      for (i = 0; i &lt; channelLength; i += 1) {
        let value = 0;
        for (let j = 0; j &lt; reduceBy; j += 1) {
          value += result[inputIndex];
          inputIndex += 1;
        }
        resampledResult[i] = 1 / reduceBy * value;
      }
      return resampledResult;
    }
    return result;
  }

  static mergeBuffers(channelBuffer, recordingLength) {
    const result = new Float32Array(recordingLength);
    let offset = 0;
    const lng = channelBuffer.length;
    for (let i = 0; i &lt; lng; i += 1) {
      const buffer = channelBuffer[i];
      result.set(buffer, offset);
      offset += buffer.length;
    }
    return result;
  }

  /**
   * Deprecated function, will be removed in favor of the pure
   * {@link wordToUTF8ByteArray} function.
   *
   * @deprecated
   * @param {DataView} view - DataView to write the bytes to.
   * @param {number} offset - Position in the DataView to start writing from.
   * @param {string} string - String to write to the DataView.
   * @returns {void} - Nothing will be returned.
   */
  static writeUTFBytes(view, offset, string) {
    const lng = string.length;
    for (let i = 0; i &lt; lng; i += 1) {
      view.setUint8(offset + i, string.charCodeAt(i));
    }
  }
}

/**
 * Get an TypedArray (an Uint8Array to be more precise) that
 * represents a string.
 *
 * @param {string} word - The word to convert.
 * @returns {Uint8Array} - The converted word as Uint8Array.
 */
export function wordToUTF8ByteArray(word) {
  const intArray = [];
  const { length } = word;
  let count = 0;

  for (count; count &lt; length; count += 1) {
    intArray.push(word.charCodeAt(count));
  }

  return Uint8Array.from(intArray);
}

/**
 * Composes a PCM WAVE file header.
 * This header will lack any size information, so in effect
 * timing information will most probably be incorrect.
 *
 * More information on the WAVE file specification can be found below.
 * For the SDK and our backend services we use the WAVE PCM format.
 *
 * @see http://www-mmsp.ece.mcgill.ca/Documents/AudioFormats/WAVE/WAVE.html
 * @param {number} channels - Channels in the audio.
 * @param {number} sampleRate - SampleRate of the audio.
 * @returns {ArrayBuffer} - The header as ArrayBuffer.
 */
export function createWAVEHeader(channels, sampleRate) {
  // Default WAVE header length is 44 bytes long.
  const buffer = new ArrayBuffer(44);
  const header = new DataView(buffer);

  // Set RIFF chunk descriptor
  wordToUTF8ByteArray('RIFF').forEach((ui8Int, index) => {
    header.setUint8(index, ui8Int);
  });

  // Set RIFF type
  wordToUTF8ByteArray('WAVE').forEach((ui8Int, index) => {
    header.setUint8(index + 8, ui8Int);
  });

  // Set FMT sub-chunk
  wordToUTF8ByteArray('fmt ').forEach((ui8Int, index) => {
    header.setUint8(index + 12, ui8Int);
  });

  // Set format chunk length
  header.setUint32(16, 16, true);

  // Set sample format (raw)
  header.setUint16(20, 1, true);

  // Set channel count. mono=1, stereo=2
  header.setUint16(22, channels, true);

  // Set sample rate
  header.setUint32(24, sampleRate, true);

  // Set byte rate (sample rate * block align)
  header.setUint32(28, sampleRate * 2 * channels, true);

  // Set block align (channel count * bytes per sample)
  header.setUint16(32, channels * 2, true);

  // Set bits per sample
  header.setUint16(34, 16, true);

  // Set data sub-chunk
  wordToUTF8ByteArray('data').forEach((ui8Int, index) => {
    header.setUint8(index + 36, ui8Int);
  });

  // Return the ArrayBuffer of the header.
  return header.buffer;
}

export default WavePacker;
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Nov 27 2018 23:02:06 GMT+0000 (UTC) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/jquery-3.1.1.min.js"></script>

<script src="scripts/search.js"></script>




</body>
</html>
